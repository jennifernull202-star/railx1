THE RAIL EXCHANGE‚Ñ¢ ‚Äî MASTER DEVELOPMENT SPEC (STRICT + FINAL)
**Claude Opus MUST FOLLOW EVERY STEP EXACTLY AS WRITTEN.

NO ALTERATIONS. NO SKIPPING. NO PLACEHOLDERS.
EVERY STEP MUST BE 100% COMPLETE BEFORE ADVANCING.**

==========================================================
üéØ SECTION 0 ‚Äî GLOBAL ENGINEERING RULES (NON-NEGOTIABLE)
==========================================================

NO PLACEHOLDERS ALLOWED.
No ‚ÄúTODO‚Äù, no dummy data, no lorem ipsum, no temporary text.

EVERY FEATURE MUST BE PRODUCTION READY.

ARCHITECTURE MUST MATCH THIS DOCUMENT EXACTLY.

UNIFIED DASHBOARD REQUIRED.
Only:

/dashboard


Everything else is modular inside it.

SHADCN UI + Tailwind for ALL components.

ALL MODELS MUST CONNECT TO REAL API ROUTES.

ALL ROUTES MUST BE PROTECTED BY NEXTAUTH + MIDDLEWARE.

EVERY SUBMISSION MUST BE FULLY VALIDATED.

ALL PAGES MUST BE RESPONSIVE AND POLISHED (AutoTrader/Airbnb style).

STRIPE VERIFIED CONTRACTOR SUBSCRIPTION = $24/month ‚Äî REQUIRED.

==========================================================
üéØ SECTION 1 ‚Äî SYSTEM SETUP
==========================================================
STEP 1 ‚Äî Initialize Next.js 14 Project

Create:

Next.js 14 (App Router)

TypeScript

Tailwind

ShadCN UI initialized

Global layout

Deliverables:
package.json, /app/layout.tsx, /app/globals.css, components/ui/*

STEP 2 ‚Äî Install Core Dependencies

Install:

next-auth
mongoose
@aws-sdk/client-s3
openai
pdf-lib
stripe
google-maps client
zustand (if needed)

STEP 3 ‚Äî Create .env.example

Values REQUIRED:

DATABASE_URL=
NEXTAUTH_SECRET=
NEXTAUTH_URL=

AWS_ACCESS_KEY_ID=
AWS_SECRET_ACCESS_KEY=
AWS_S3_BUCKET=

STRIPE_SECRET_KEY=
STRIPE_WEBHOOK_SECRET=
STRIPE_PUBLIC_KEY=

GOOGLE_MAPS_API_KEY=
OPENAI_API_KEY=

STEP 4 ‚Äî Mongo Connection Utility

Create:

/lib/db.ts
Must include:

Global cached connection

Error handling

Auto-reconnect

==========================================================
üéØ SECTION 2 ‚Äî USER + AUTH SYSTEM
==========================================================
STEP 5 ‚Äî User Model

Required fields:

name
email
passwordHash
role (buyer | seller | contractor | admin)
image
createdAt
updatedAt

STEP 6 ‚Äî NextAuth Configuration

MUST:

Use credential provider (email + password)

Load user.role into JWT

Load contractorProfileExists into session

NO placeholders

Full error handling

JWT MUST include:

token.role = user.role
token.contractorProfileExists = contractorHasProfile
session.user.role = token.role
session.user.contractorProfileExists = token.contractorProfileExists

STEP 7 ‚Äî Auth Pages

Create:

/auth/register
/auth/login
/auth/forgot-password

All with production UI (ShadCN cards, inputs, buttons).

STEP 8 ‚Äî Registration Role Selection

User MUST choose:

Buyer/Seller

Contractor

This determines dashboard modules.

==========================================================
üéØ SECTION 3 ‚Äî UNIFIED DASHBOARD (MANDATORY)
==========================================================
STEP 9 ‚Äî DELETE ALL OLD DASHBOARDS

ABSOLUTELY REMOVE:

/dashboard/buyer
/dashboard/seller
/dashboard/contractor
/contractors/register
/contractors/onboard


CLAUDE MUST CONFIRM DELETION BEFORE MOVING ON.

STEP 10 ‚Äî Create Unified Dashboard Layout

Path:

/dashboard/layout.tsx


Includes:

Left side navigation (role-based items)

Top header

ShadCN UI components

Dynamic module loader

STEP 11 ‚Äî Dashboard Modules (Role-Based)

Inside:

/dashboard/modules/


Create folders:

buyer/
seller/
contractor/
admin/


Dashboard landing loads modules depending on:

session.user.role
session.user.contractorProfileExists

STEP 12 ‚Äî Contractor Setup INSIDE Dashboard

NEW PATH:

/dashboard/contractor/setup


Includes:

Business info

Services offered

Regions served

Insurance & documents upload

Experience

Equipment

Profile photo & logo

SAVE & CONTINUE logic

STEP 13 ‚Äî Stripe Verification Subscription ($24/month)

Contractor sees tile:

Status: Not Verified
[ Become Verified ‚Äì $24/month ]


Stripe Checkout ‚Üí creates subscription.

Webhook must:

Mark contractor verified = true

Save verificationSubscriptionId

Update verificationStatus = "verified"

When subscription ends:

verified = false

STEP 14 ‚Äî Middleware Rewrite

MUST enforce:

If NOT authenticated ‚Üí /auth/login
If dashboard ‚Üí allow
If contractorProfileExists = false ‚Üí show contractor setup module inside dashboard
NO LOOPS
NO redirects to removed contractor URLs

==========================================================
üéØ SECTION 4 ‚Äî CONTRACTOR SYSTEM
==========================================================
STEP 15 ‚Äî ContractorProfile Model

Fields MUST include:

businessName
services[]
regions[]
insuranceDocs (S3)
safetyDocs (S3)
experience
equipment
logoUrl
verificationStatus
verified (boolean)
verificationSubscriptionId

STEP 16 ‚Äî Contractor API Routes

Create:

POST    /api/contractor/setup
PUT     /api/contractor
GET     /api/contractor/[id]
GET     /api/contractor


MUST handle:

Validation

Authentication

Error handling

STEP 17 ‚Äî Contractor Profile Page

Path:

/contractors/[id]


Display:

Verified badge

Services

Regions (Google Maps)

Photos

Contact button

Add-on badges

==========================================================
üéØ SECTION 5 ‚Äî MARKETPLACE SYSTEM
==========================================================
STEP 18 ‚Äî Listing Model

Fields:

title
description
category
price
region
sellerId
photos[]
status
addOns[]
createdAt
updatedAt

STEP 19 ‚Äî Listing API Routes

CRUD:

POST    /api/listings
GET     /api/listings
GET     /api/listings/[id]
PUT     /api/listings/[id]
DELETE  /api/listings/[id]

STEP 20 ‚Äî Listing Creation Page

Features:

S3 upload

Category selector

Region autocomplete

Add-on options

STEP 21 ‚Äî Listing Detail Page

AutoTrader-style with:

Gallery

Price sidebar

Seller card

Verified seller indicator

Watchlist button

Contact seller

==========================================================
üéØ SECTION 6 ‚Äî HOMEPAGE + SEARCH
==========================================================
STEP 22 ‚Äî Hero Search Bar

AutoTrader/Airbnb hybrid:

Keyword search

Category dropdown

Region autocomplete

CTA buttons

STEP 23 ‚Äî Contractor Map Search

Google Maps: markers + sidebar filters.

STEP 24 ‚Äî Featured Listings

Pulled based on add-ons.

STEP 25 ‚Äî Add-On Explainer

Explain all add-ons.

STEP 26 ‚Äî Category Tiles

Modern, ShadCN card grid.

==========================================================
üéØ SECTION 7 ‚Äî MONETIZATION + AI TOOLS
==========================================================
STEP 27 ‚Äî AddOnPurchase Model
STEP 28 ‚Äî Add-On Purchase API
STEP 29 ‚Äî Ranking Logic
STEP 30 ‚Äî AI Enhancement Endpoint
STEP 31 ‚Äî Spec Sheet PDF Generator
==========================================================
üéØ SECTION 8 ‚Äî SEARCH ENGINE
==========================================================
STEP 32 ‚Äî /api/search Endpoint
STEP 33 ‚Äî /search UI Page
==========================================================
üéØ SECTION 9 ‚Äî USER TOOLS
==========================================================
STEP 34 ‚Äî Watchlist
STEP 35 ‚Äî Saved Searches
STEP 36 ‚Äî Notification System
==========================================================
üéØ SECTION 10 ‚Äî MESSAGING SYSTEM
==========================================================
STEP 37 ‚Äî Message Model
STEP 38 ‚Äî Messaging API
STEP 39 ‚Äî Messaging UI (ThreadList, ChatWindow)
==========================================================
üéØ SECTION 11 ‚Äî ADMIN DASHBOARD (FULL ENTERPRISE PANEL)
==========================================================

Admin module MUST include:

Users
Listings
Contractors
Contractor Verification Queue
Add-On Revenue Analytics
Stripe Payments Dashboard
Marketplace Analytics
Category Management
Moderation Hub
System Logs

Admin MUST see full financial breakdown including:

Verified badge revenue ($24/mo)

Add-on revenue

MRR

Churn

Subscription statuses

==========================================================
üéØ SECTION 12 ‚Äî FINAL POLISH & DEPLOYMENT
==========================================================
STEP 40 ‚Äî UI/UX Cleanup
STEP 41 ‚Äî Vercel Deployment
STEP 42 ‚Äî Comprehensive QA Testing